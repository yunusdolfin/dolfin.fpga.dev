name: CI

on: [push, pull_request]

jobs:
  build:
    runs-on: self-hosted
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v2

    - name: Set execution policy
      run: Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope Process
      shell: powershell

    - name: Set up Vivado environment
      run: D:\Xilinx\Vivado\2022.1\settings64.bat
      shell: cmd

    - name: Go to fusesoc.core directory
      run: cd fpga
      shell: cmd

    - name: Go to fusesoc.core directory
      run: dir
      shell: cmd

    - name: Add fusesoc library
      run: fusesoc library add jtag_to_axi_master .
      shell: cmd

    - name: Create Vivado project and run
      run: fusesoc run --target=synth --setup --build --no-export jtag_to_axi_master
      shell: cmd
